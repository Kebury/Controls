<Window x:Class="Controls.Views.DepartmentTaskEditWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:models="clr-namespace:Controls.Models"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}" 
        Height="750" Width="800"
        MinHeight="600" MinWidth="680"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource SecondaryBackground}"
        ResizeMode="CanResizeWithGrip"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True"
        TextOptions.TextFormattingMode="Display"
        TextOptions.TextRenderingMode="ClearType">
    
    <Window.Resources>
        <ObjectDataProvider x:Key="ImportancePriorityEnum" 
                            MethodName="GetValues" 
                            ObjectType="{x:Type models:ImportancePriority}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="models:ImportancePriority"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </Window.Resources>

    <Grid Margin="30">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" 
                   Text="{Binding WindowTitle}" 
                   FontSize="24" 
                   FontWeight="Bold" 
                   Foreground="{DynamicResource PrimaryText}"
                   Margin="0,0,0,25"/>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <Border Background="{DynamicResource PrimaryBackground}" 
                        BorderBrush="{DynamicResource PrimaryBorder}" 
                        BorderThickness="1"
                        CornerRadius="8" 
                        Padding="20"
                        Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="📋 Основные данные" 
                                   FontSize="16" 
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource PrimaryText}"
                                   Margin="0,0,0,15"/>

                        <StackPanel Margin="0,0,0,15">
                            <TextBlock Text="Номер задания*" 
                                       FontSize="13" 
                                       Foreground="{DynamicResource SecondaryText}"
                                       Margin="0,0,0,5"/>
                            <TextBox Text="{Binding TaskNumber, UpdateSourceTrigger=PropertyChanged}" 
                                     IsEnabled="{Binding CanEditFields}"
                                     FontSize="14"
                                     Padding="10"
                                     BorderBrush="{DynamicResource PrimaryBorder}"
                                     BorderThickness="1"/>
                        </StackPanel>

                        <StackPanel Margin="0,0,0,15">
                            <Grid Margin="0,0,0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0"
                                           Text="Организации*" 
                                           FontSize="13" 
                                           Foreground="{DynamicResource SecondaryText}"/>
                                <TextBlock Grid.Column="1"
                                           FontSize="12"
                                           Foreground="{DynamicResource ButtonPrimary}"
                                           FontWeight="SemiBold">
                                    <Run Text="Выбрано: "/>
                                    <Run Text="{Binding SelectedDepartmentsCount, Mode=OneWay}"/>
                                </TextBlock>
                            </Grid>
                            
                            <Border BorderBrush="{DynamicResource PrimaryBorder}"
                                    BorderThickness="1"
                                    CornerRadius="5"
                                    MaxHeight="200">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <ItemsControl ItemsSource="{Binding DepartmentSelections}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Padding="10,5" 
                                                        Background="{DynamicResource SecondaryBackground}"
                                                        Margin="5">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        
                                                        <CheckBox Grid.Column="0"
                                                                  IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                                  IsEnabled="{Binding DataContext.CanEditFields, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                  VerticalAlignment="Center"
                                                                  Margin="0,0,10,0"
                                                                  Cursor="Hand"/>
                                                        
                                                        <TextBlock Grid.Column="1"
                                                                   Text="{Binding Department.ShortName}"
                                                                   VerticalAlignment="Center"
                                                                   FontSize="13"
                                                                   Foreground="{DynamicResource PrimaryText}"
                                                                   ToolTip="{Binding Department.FullName}"/>
                                                        
                                                        <CheckBox Grid.Column="2"
                                                                  IsChecked="{Binding IsCompleted, Mode=TwoWay}"
                                                                  Content="Исполнено"
                                                                  VerticalAlignment="Center"
                                                                  FontSize="12"
                                                                  Foreground="{DynamicResource SecondaryText}"
                                                                  Cursor="Hand">
                                                            <CheckBox.Style>
                                                                <Style TargetType="CheckBox">
                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding IsSelected}" Value="False">
                                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </CheckBox.Style>
                                                        </CheckBox>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Border>
                        </StackPanel>

                        <StackPanel Margin="0,0,0,15">
                            <TextBlock Text="Исполнитель" 
                                       FontSize="13" 
                                       Foreground="{DynamicResource SecondaryText}"
                                       Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding Executors}"
                                      IsEnabled="{Binding CanEditFields}"
                                      SelectedItem="{Binding SelectedExecutor}"
                                      DisplayMemberPath="ShortName"
                                      FontSize="14"
                                      Padding="10"
                                      BorderBrush="{DynamicResource PrimaryBorder}"
                                      BorderThickness="1"/>
                        </StackPanel>

                        <StackPanel Margin="0,0,0,15">
                            <TextBlock Text="Откуда поступило задание" 
                                       FontSize="13" 
                                       Foreground="{DynamicResource SecondaryText}"
                                       Margin="0,0,0,5"/>
                            <TextBox Text="{Binding Source, UpdateSourceTrigger=PropertyChanged}" 
                                     IsEnabled="{Binding CanEditFields}"
                                     FontSize="14"
                                     Padding="10"
                                     BorderBrush="{DynamicResource PrimaryBorder}"
                                     BorderThickness="1"/>
                        </StackPanel>

                        <StackPanel Margin="0,0,0,15">
                            <TextBlock Text="Краткое описание задания" 
                                       FontSize="13" 
                                       Foreground="{DynamicResource SecondaryText}"
                                       Margin="0,0,0,5"/>
                            <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" 
                                     IsEnabled="{Binding CanEditFields}"
                                     FontSize="14"
                                     Padding="10"
                                     Height="80"
                                     TextWrapping="Wrap"
                                     AcceptsReturn="True"
                                     VerticalScrollBarVisibility="Auto"
                                     BorderBrush="{DynamicResource PrimaryBorder}"
                                     BorderThickness="1"/>
                        </StackPanel>

                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="15"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Дата направления*" 
                                           FontSize="13" 
                                           Foreground="{DynamicResource SecondaryText}"
                                           Margin="0,0,0,5"/>
                                <DatePicker SelectedDate="{Binding SentDate}" 
                                            IsEnabled="{Binding CanEditFields}"
                                            FontSize="14"
                                            Padding="10"
                                            BorderBrush="{DynamicResource PrimaryBorder}"
                                            BorderThickness="1"
                                            Cursor="Hand"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Дата исполнения*" 
                                           FontSize="13" 
                                           Foreground="{DynamicResource SecondaryText}"
                                           Margin="0,0,0,5"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <DatePicker Grid.Column="0"
                                                SelectedDate="{Binding DueDate}" 
                                                IsEnabled="{Binding CanEditFields}"
                                                FontSize="14"
                                                Padding="10"
                                                BorderBrush="{DynamicResource PrimaryBorder}"
                                                BorderThickness="1"
                                                Cursor="Hand"
                                                Margin="0,0,10,0"/>

                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                        <TextBox Text="{Binding DueTimeHour, UpdateSourceTrigger=PropertyChanged}"
                                                 IsEnabled="{Binding CanEditFields}"
                                                 Width="60"
                                                 FontSize="14"
                                                 Padding="8"
                                                 BorderBrush="{DynamicResource PrimaryBorder}"
                                                 BorderThickness="1"
                                                 Margin="0,0,5,0"
                                                 VerticalContentAlignment="Center"
                                                 HorizontalContentAlignment="Center"
                                                 ToolTip="Час (0-23)"
                                                 MaxLength="2"
                                                 PreviewTextInput="NumericTextBox_PreviewTextInput"/>
                                        <TextBlock Text=":" 
                                                   VerticalAlignment="Center" 
                                                   FontSize="16" 
                                                   FontWeight="Bold"
                                                   Margin="0,0,5,0"/>
                                        <TextBox Text="{Binding DueTimeMinute, UpdateSourceTrigger=PropertyChanged}"
                                                 IsEnabled="{Binding CanEditFields}"
                                                 Width="60"
                                                 FontSize="14"
                                                 Padding="8"
                                                 BorderBrush="{DynamicResource PrimaryBorder}"
                                                 BorderThickness="1"
                                                 VerticalContentAlignment="Center"
                                                 HorizontalContentAlignment="Center"
                                                 ToolTip="Минуты (0-59)"
                                                 MaxLength="2"
                                                 PreviewTextInput="NumericTextBox_PreviewTextInput"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Grid>

                        <StackPanel Margin="0,0,0,15">
                            <TextBlock Text="Важность*" 
                                       FontSize="13" 
                                       Foreground="{DynamicResource SecondaryText}"
                                       Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding Source={StaticResource ImportancePriorityEnum}}"
                                      IsEnabled="{Binding CanEditFields}"
                                      SelectedItem="{Binding ImportancePriority}"
                                      FontSize="14"
                                      Padding="10"
                                      BorderBrush="{DynamicResource PrimaryBorder}"
                                      BorderThickness="1">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </StackPanel>

                        <StackPanel>
                            <TextBlock Text="Примечания" 
                                       FontSize="13" 
                                       Foreground="{DynamicResource SecondaryText}"
                                       Margin="0,0,0,5"/>
                            <TextBox Text="{Binding Notes, UpdateSourceTrigger=PropertyChanged}" 
                                     IsEnabled="{Binding CanEditFields}"
                                     FontSize="14"
                                     Padding="10"
                                     Height="60"
                                     TextWrapping="Wrap"
                                     AcceptsReturn="True"
                                     VerticalScrollBarVisibility="Auto"
                                     BorderBrush="{DynamicResource PrimaryBorder}"
                                     BorderThickness="1"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <Border Background="{DynamicResource PrimaryBackground}" 
                        BorderBrush="{DynamicResource PrimaryBorder}" 
                        BorderThickness="1"
                        CornerRadius="8" 
                        Padding="20"
                        Margin="0,15,0,0">
                    <StackPanel>
                        <TextBlock Text="📎 Прикреплённые документы" 
                                   FontSize="16" 
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource PrimaryText}"
                                   Margin="0,0,0,20"/>

                        <StackPanel Margin="0,0,0,20">
                            <Grid Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0"
                                           Text="📝 Прилагаемые файлы задания" 
                                           FontSize="14" 
                                           FontWeight="SemiBold"
                                           Foreground="{DynamicResource PrimaryText}"
                                           VerticalAlignment="Center"/>
                                <Button Grid.Column="1"
                                        Content="➕ Добавить"
                                        Command="{Binding AddTaskFileCommand}"
                                        FontSize="12"
                                        Padding="10,5"
                                        Background="{DynamicResource ButtonPrimary}"
                                        Foreground="White"
                                        BorderThickness="0"
                                        Cursor="Hand">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Background" Value="{DynamicResource ButtonPrimary}"/>
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}" 
                                                                CornerRadius="4"
                                                                Padding="{TemplateBinding Padding}">
                                                            <ContentPresenter HorizontalAlignment="Center" 
                                                                              VerticalAlignment="Center"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="{DynamicResource ButtonPrimaryHover}"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </Grid>

                            <ItemsControl ItemsSource="{Binding TaskFiles}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{DynamicResource SecondaryBackground}"
                                                BorderBrush="{DynamicResource PrimaryBorder}"
                                                BorderThickness="1"
                                                CornerRadius="5"
                                                Padding="10"
                                                Margin="0,0,0,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0"
                                                           Text="📝"
                                                           FontSize="16"
                                                           VerticalAlignment="Center"
                                                           Margin="0,0,10,0"/>

                                                <TextBlock Grid.Column="1" 
                                                           Text="{Binding}" 
                                                           FontSize="13"
                                                           FontWeight="SemiBold"
                                                           Foreground="{DynamicResource PrimaryText}"
                                                           VerticalAlignment="Center"
                                                           TextTrimming="CharacterEllipsis"/>

                                                <Button Grid.Column="2"
                                                        Content="🗑️"
                                                        Command="{Binding DataContext.RemoveTaskFileCommand, RelativeSource={RelativeSource AncestorType=Border, AncestorLevel=2}}"
                                                        CommandParameter="{Binding}"
                                                        FontSize="14"
                                                        Padding="8,4"
                                                        Background="{DynamicResource ButtonDanger}"
                                                        Foreground="White"
                                                        BorderThickness="0"
                                                        Cursor="Hand"
                                                        ToolTip="Удалить">
                                                    <Button.Style>
                                                        <Style TargetType="Button">
                                                            <Setter Property="Background" Value="{DynamicResource ButtonDanger}"/>
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate TargetType="Button">
                                                                        <Border Background="{TemplateBinding Background}" 
                                                                                CornerRadius="3"
                                                                                Padding="{TemplateBinding Padding}">
                                                                            <ContentPresenter HorizontalAlignment="Center" 
                                                                                              VerticalAlignment="Center"/>
                                                                        </Border>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                            <Style.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter Property="Background" Value="{DynamicResource ButtonDangerHover}"/>
                                                                </Trigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Button.Style>
                                                </Button>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <TextBlock Text="Документы не прикреплены"
                                       FontSize="12"
                                       Foreground="{DynamicResource TertiaryText}"
                                       FontStyle="Italic"
                                       Margin="0,5,0,0">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding TaskFiles.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>

                        <StackPanel>
                            <Grid Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0"
                                           Text="📨 Файлы, поступающие от организаций" 
                                           FontSize="14" 
                                           FontWeight="SemiBold"
                                           Foreground="{DynamicResource PrimaryText}"
                                           VerticalAlignment="Center"/>
                                <Button Grid.Column="1"
                                        Content="➕ Добавить"
                                        Command="{Binding AddDepartmentFileCommand}"
                                        FontSize="12"
                                        Padding="10,5"
                                        Background="{DynamicResource ButtonPrimary}"
                                        Foreground="White"
                                        BorderThickness="0"
                                        Cursor="Hand">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Background" Value="{DynamicResource ButtonPrimary}"/>
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}" 
                                                                CornerRadius="4"
                                                                Padding="{TemplateBinding Padding}">
                                                            <ContentPresenter HorizontalAlignment="Center" 
                                                                              VerticalAlignment="Center"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="{DynamicResource ButtonPrimaryHover}"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </Grid>

                            <ItemsControl ItemsSource="{Binding DepartmentFiles}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{DynamicResource SecondaryBackground}"
                                                BorderBrush="{DynamicResource PrimaryBorder}"
                                                BorderThickness="1"
                                                CornerRadius="5"
                                                Padding="10"
                                                Margin="0,0,0,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0"
                                                           Text="📝"
                                                           FontSize="16"
                                                           VerticalAlignment="Center"
                                                           Margin="0,0,10,0"/>

                                                <TextBlock Grid.Column="1" 
                                                           Text="{Binding}" 
                                                           FontSize="13"
                                                           FontWeight="SemiBold"
                                                           Foreground="{DynamicResource PrimaryText}"
                                                           VerticalAlignment="Center"
                                                           TextTrimming="CharacterEllipsis"/>

                                                <Button Grid.Column="2"
                                                        Content="🗑️"
                                                        Command="{Binding DataContext.RemoveDepartmentFileCommand, RelativeSource={RelativeSource AncestorType=Border, AncestorLevel=2}}"
                                                        CommandParameter="{Binding}"
                                                        FontSize="14"
                                                        Padding="8,4"
                                                        Background="{DynamicResource ButtonDanger}"
                                                        Foreground="White"
                                                        BorderThickness="0"
                                                        Cursor="Hand"
                                                        ToolTip="Удалить">
                                                    <Button.Style>
                                                        <Style TargetType="Button">
                                                            <Setter Property="Background" Value="{DynamicResource ButtonDanger}"/>
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate TargetType="Button">
                                                                        <Border Background="{TemplateBinding Background}" 
                                                                                CornerRadius="3"
                                                                                Padding="{TemplateBinding Padding}">
                                                                            <ContentPresenter HorizontalAlignment="Center" 
                                                                                              VerticalAlignment="Center"/>
                                                                        </Border>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                            <Style.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter Property="Background" Value="{DynamicResource ButtonDangerHover}"/>
                                                                </Trigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Button.Style>
                                                </Button>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <TextBlock Text="Документы не прикреплены"
                                       FontSize="12"
                                       Foreground="{DynamicResource TertiaryText}"
                                       FontStyle="Italic"
                                       Margin="0,5,0,0">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding DepartmentFiles.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <Grid Grid.Row="2" Margin="0,25,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Command="{Binding CancelCommand}"
                    Grid.Column="0"
                    HorizontalAlignment="Left"
                    Padding="25,10"
                    FontSize="14"
                    BorderThickness="0"
                    Cursor="Hand">
                <TextBlock Text="Отмена"/>
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="{DynamicResource SecondaryBackground}"/>
                        <Setter Property="Foreground" Value="{DynamicResource SecondaryText}"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}"
                                            BorderBrush="{DynamicResource PrimaryBorder}"
                                            BorderThickness="1"
                                            CornerRadius="5"
                                            Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource HoverBackground}"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <Button Command="{Binding SaveCommand}"
                    Grid.Column="1"
                    Visibility="{Binding CanEditFields, Converter={StaticResource BoolToVisibilityConverter}}"
                    Padding="25,10"
                    FontSize="14"
                    BorderThickness="0"
                    Cursor="Hand">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="💾" Margin="0,0,8,0"/>
                    <TextBlock Text="Сохранить"/>
                </StackPanel>
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="{DynamicResource ButtonSuccess}"/>
                        <Setter Property="Foreground" Value="White"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}"
                                            CornerRadius="5"
                                            Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource ButtonSuccessHover}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </Grid>
    </Grid>
</Window>
