<Window x:Class="Controls.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Controls"
        xmlns:vm="clr-namespace:Controls.ViewModels"
        xmlns:views="clr-namespace:Controls.Views"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        mc:Ignorable="d"
        Title="{Binding AppTitle, FallbackValue='Задачи'}" 
        Height="700" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource SecondaryBackground}"
        StateChanged="Window_StateChanged"
        Closing="Window_Closing"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True"
        TextOptions.TextFormattingMode="Display"
        TextOptions.TextRenderingMode="ClearType"
        RenderOptions.BitmapScalingMode="HighQuality"
        RenderOptions.ClearTypeHint="Enabled"
        RenderOptions.EdgeMode="Unspecified">
    
    <Window.Resources>
        <DataTemplate DataType="{x:Type vm:TasksViewModel}">
            <views:TasksView/>
        </DataTemplate>
        
        <DataTemplate DataType="{x:Type vm:DepartmentTasksViewModel}">
            <views:DepartmentTasksView/>
        </DataTemplate>
        
        <DataTemplate DataType="{x:Type vm:NotificationsViewModel}">
            <views:NotificationsView/>
        </DataTemplate>
        
        <DataTemplate DataType="{x:Type vm:CalendarViewModel}">
            <views:CalendarView/>
        </DataTemplate>
        
        <DataTemplate DataType="{x:Type vm:ArchiveViewModel}">
            <views:ArchiveView/>
        </DataTemplate>
        
        <DataTemplate DataType="{x:Type vm:SettingsViewModel}">
            <views:SettingsView/>
        </DataTemplate>

        <tb:TaskbarIcon x:Key="TrayIcon"
                        x:Name="TrayIcon"
                        IconSource="Resources/app.ico"
                        ToolTipText="Задачи"
                        TrayMouseDoubleClick="TrayIcon_TrayMouseDoubleClick">
            <tb:TaskbarIcon.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Открыть" Click="ShowWindow_Click" FontWeight="Bold"/>
                    <Separator/>
                    <MenuItem Header="Выход" Click="ExitApplication_Click"/>
                </ContextMenu>
            </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" 
                Background="{DynamicResource SidebarBackground}" 
                BorderThickness="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Margin="20" VerticalAlignment="Top">
                    <TextBlock Text="📋" 
                               FontSize="40" 
                               Foreground="{DynamicResource SidebarText}"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,10"/>
                    <TextBlock Text="Задачи" 
                               FontSize="18" 
                               FontWeight="Bold"
                               Foreground="{DynamicResource SidebarText}"
                               HorizontalAlignment="Center"
                               TextWrapping="Wrap"
                               TextAlignment="Center"/>
                    <TextBlock Text="{Binding OrganizationName}" 
                               FontSize="11" 
                               Foreground="{DynamicResource SidebarSecondaryText}"
                               HorizontalAlignment="Center"
                               Margin="0,5,0,0"
                               TextWrapping="Wrap"
                               TextAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Row="1" Margin="0,20,0,0">
                    <Button Command="{Binding ShowTasksCommand}"
                            Style="{StaticResource NavButtonStyle}"
                            Margin="10,5">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="📝" FontSize="18" Margin="0,0,10,0"/>
                            <TextBlock Text="Задания организации" FontSize="14"/>
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding ShowDepartmentTasksCommand}"
                            Style="{StaticResource NavButtonStyle}"
                            Margin="10,5">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="📝➡️" FontSize="18" Margin="0,0,10,0"/>
                            <TextBlock Text="Задания в организации" FontSize="14"/>
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding ShowNotificationsCommand}"
                            Style="{StaticResource NavButtonStyle}"
                            Margin="10,5">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="🔔" FontSize="18" Margin="0,0,10,0"/>
                            <TextBlock Text="Уведомления" FontSize="14"/>
                            <Border Background="{DynamicResource BadgeBackground}" 
                                    CornerRadius="10" 
                                    Padding="6,2"
                                    Margin="8,0,0,0"
                                    Visibility="{Binding UnreadNotificationsCount, Converter={StaticResource CountToVisibilityConverter}}">
                                <TextBlock Text="{Binding UnreadNotificationsCount}" 
                                           Foreground="{DynamicResource SidebarText}" 
                                           FontSize="11"
                                           FontWeight="Bold"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Border>
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding ShowCalendarCommand}"
                            Style="{StaticResource NavButtonStyle}"
                            Margin="10,5">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="📅" FontSize="18" Margin="0,0,10,0"/>
                            <TextBlock Text="Календарь" FontSize="14"/>
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding ShowDocumentsCommand}"
                            Style="{StaticResource NavButtonStyle}"
                            Margin="10,5">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="📦" FontSize="18" Margin="0,0,10,0"/>
                            <TextBlock Text="Архив" FontSize="14"/>
                        </StackPanel>
                    </Button>

                    <Border Height="1" 
                            Background="{DynamicResource SidebarSeparator}" 
                            Margin="20,20"/>

                    <Button Command="{Binding ShowSettingsCommand}"
                            Style="{StaticResource NavButtonStyle}"
                            Margin="10,5">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="⚙️" FontSize="18" Margin="0,0,10,0"/>
                            <TextBlock Text="Настройки" FontSize="14"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

                <StackPanel Grid.Row="2" Margin="20,20,20,30">
                    <TextBlock Text="© 2026 Controls" 
                               FontSize="10" 
                               Foreground="{DynamicResource SidebarSecondaryText}"
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="v1.0.1" 
                               FontSize="10" 
                               Foreground="{DynamicResource SidebarSecondaryText}"
                               HorizontalAlignment="Center"
                               Margin="0,5,0,0"/>
                    <TextBlock Text="Разработал: Канатов М.Э." 
                               FontSize="10" 
                               Foreground="{DynamicResource SidebarSecondaryText}"
                               HorizontalAlignment="Center"
                               Margin="0,10,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <Border Grid.Column="1" 
                Background="{DynamicResource PrimaryBackground}"
                CornerRadius="15,0,0,0"
                Padding="0">
            <ContentControl Content="{Binding CurrentView}"/>
        </Border>
    </Grid>
</Window>
